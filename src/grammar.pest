num = @{ int ~ ("." ~ ASCII_DIGIT*)? ~ (^"e" ~ int)? }
    int = { ("+" | "-")? ~ ASCII_DIGIT+ }

boolean = @{ "true" | "false" }
ident = @{ ALPHABETIC ~ (ALPHABETIC | ASCII_DIGIT )* }

operation = _{
    add | subtract | multiply | divide | power |
    eq | neq | lt | lte | gt | gte
}
    add      = { "+" }
    subtract = { "-" }
    multiply = { "*" }
    divide   = { "/" }
    power    = { "^" }
    eq       = { "==" }
    neq      = { "!=" }
    lt       = { "<" }
    lte      = { "<=" }
    gt       = { ">" }
    gte      = { ">=" }

unop = _{ neg | not | ref | deref }
    not   = { "!" }
    ref   = { "&" }
    neg   = { "-" }
    deref = { "*" }

if = {
    "if" ~ expr ~ ":" ~ expr ~ "else" ~ expr
}

idents = { (ident ~ ("," ~ ident)*)? ~ ","? }
exprs = { (expr ~ ("," ~ expr)*)? ~ ","? }

lambda = {
    "fn" ~ "(" ~ idents ~ ")" ~ expr
}
call = {
    ident ~ "(" ~ exprs ~ ")"
}

literal = { num | boolean }
expr = { term ~ (operation ~ term)*}
term = _{ if | lambda | literal | call | ident | unop ~ term | "(" ~ expr ~ ")" }

let_binding = { "let" ~ ident ~ "=" ~ expr }
var_binding = { "var" ~ ident ~ "=" ~ expr }
rebinding = { ident ~ "=" ~ expr }

query = _{ SOI ~
    (let_binding | var_binding | rebinding | expr)
~ EOI }

WHITESPACE = _{ " " | "\t" }
